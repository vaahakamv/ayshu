<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Home · Vaahaka</title>
  <link rel="stylesheet" href="/ayshu/assets/app.css?v=5">
</head>
<body>
  <header class="nav">
    <div class="wrap bar" style="justify-content:space-between;">
      <a href="/ayshu/" class="brand">Vaahaka</a>
      <nav class="bar">
        <a href="/ayshu/explore.html">Explore</a>
        <a href="/ayshu/write.html">Write</a>
        <a href="/ayshu/about.html">About</a>
        <a href="/ayshu/mypanel.html">My Panel</a>
      </nav>
    </div>
  </header>

  <div id="toast" class="toast"></div>

  <!-- Hero / Welcome -->
  <section class="hero">
    <div class="wrap">
      <h1>Welcome to Vaahaka</h1>
      <p class="muted">
        A light, modern space for original stories in Dhivehi and English — singles and weekly series —
        lovingly curated by <b>Ayshu</b> and our contributors.
      </p>
      <p class="muted" style="margin-top:6px">
        Find something new, follow a series, and enjoy a calm reading experience. Tap <b>Explore</b> to dive in,
        or <b>Write</b> to start your own story.
      </p>
      <div class="bar" style="margin-top:12px; gap:8px;">
        <a class="pill" href="/ayshu/explore.html">Explore stories</a>
        <a class="pill ghost" href="/ayshu/write.html">Start writing</a>
      </div>
    </div>
  </section>

  <!-- New first -->
  <div class="wrap section">
    <h2>New</h2>
    <div id="latest" class="grid cards"></div>
  </div>

  <!-- Then Trending -->
  <div class="wrap section">
    <h2>Trending</h2>
    <div id="trending" class="grid cards"></div>
  </div>

  <script type="module">
    import { listTrending, listPublishedStories } from "/ayshu/assets/firebase.js?v=113";

    const latestEl  = document.getElementById('latest');
    const trendingEl = document.getElementById('trending');

    const card = (s) => `
      <a class="card" href="/ayshu/story.html?id=${s.id}">
        <div><b>${s.title || '(untitled)'}</b></div>
        <div class="muted">
          ${(s.language || '').toUpperCase()} · ${s.type} · ${Array.isArray(s.genres) ? s.genres.join(', ') : ''}
        </div>
      </a>`;

    (async () => {
      try {
        // New (latest published)
        const latest = await listPublishedStories(12);
        latestEl.innerHTML = latest.length
          ? latest.map(card).join('')
          : '<div class="muted">No stories yet.</div>';

        // Trending
        const trend = await listTrending(6);
        trendingEl.innerHTML = trend.length
          ? trend.map(card).join('')
          : '<div class="muted">No trending yet.</div>';
      } catch (e) {
        console.error(e);
      }
    })();
  </script>
</body>
</html>
