<!doctype html><html lang="en"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>Story 路 Vaahaka</title>
<link rel="stylesheet" href="/ayshu/assets/app.css?v=3">
</head><body>
<header class="nav">
  <div class="wrap bar" style="justify-content:space-between;">
    <a href="/ayshu/" class="brand">Vaahaka</a>
    <nav class="bar">
      <a href="/ayshu/explore.html">Explore</a>
      <a href="/ayshu/write.html">Write</a>
      <a href="/ayshu/about.html">About</a>
      <a href="/ayshu/mypanel.html">My Panel</a>
    </nav>
  </div>
</header>
<div id="toast" class="toast"></div>

<div class="wrap section">
  <div id="authBar" class="card bar" style="display:flex; gap:8px;">
    <input id="email" placeholder="Email">
    <input id="pass" type="password" placeholder="Password">
    <button id="btnLogin">Login</button>
    <button id="btnSignup" class="ghost">Sign up</button>
    <button id="btnGoogle" class="ghost">Google</button>
  </div>
  <div id="userBar" class="card bar" style="display:none; justify-content:space-between;">
    <div id="who" class="muted"></div>
    <div class="bar"><button id="btnLogout" class="ghost">Logout</button></div>
  </div>
</div>
<script type="module">
  import { wireAuthBar } from "/ayshu/assets/firebase.js?v=103"; wireAuthBar();
</script>

<div class="wrap section"><div id="storyBox" class="grid" style="gap:16px"></div></div>
<script type="module">
  import { getStory, getSinglePost, listSeriesParts, bumpHot } from "/ayshu/assets/firebase.js?v=103";
  const box = document.getElementById('storyBox'); const params = new URLSearchParams(location.search); const id = params.get('id');
  async function load(){ if (!id){ box.innerHTML='<div class="muted">Story not found.</div>'; return; }
    const s = await getStory(id); if (!s){ box.innerHTML='<div class="muted">Story not found.</div>'; return; }
    document.title = (s.title||'Story') + ' 路 Vaahaka';
    let bodyHTML = '';
    if (s.type==='single'){ const post = await getSinglePost(id); bodyHTML = post?.body ? `<article>${(post.body).replace(/\n/g,'<br>')}</article>` : '<div class="muted">No content.</div>'; }
    else { const parts = await listSeriesParts(id);
      bodyHTML = parts.length ? parts.map(p=>`<div class="card"><h3>${p.title||('Part '+p.partNumber)}</h3><article>${(p.body||'').replace(/\n/g,'<br>')}</article></div>`).join('') : '<div class="muted">No parts yet.</div>'; }
    box.innerHTML = `<div class="card"><h2>${s.title||'(untitled)'} </h2><div class="muted">${(s.language||'').toUpperCase()} 路 ${s.type} 路 ${s.genres?.join(', ')||''}</div></div>` + bodyHTML;
    try{ await bumpHot(id, 1); }catch{}
  } load();
</script>
</body></html>